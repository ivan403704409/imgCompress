<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>NEC：更好的CSS方案</title>
<meta name="keywords" content=""/>
<meta name="description" content=""/>
<script src="jquery.js" ></script>
</head>
<body>
<form action="">
    <input id="file1" type="file">    
</form>
<canvas id="canvas1" style=" background:#000; _display:none"></canvas>
<script>

function ImgCompress( id ){


    if( bCreated ){
        self;
        return;
    }else{

        bCreated = true
        self = this;
    }
    this.canvas = document.getElementById(id);
    this.scale = 1;
    self.file = $(':file')[0].files[0];

}

ImgCompress.prototype = {

    init: function (opts){
        var self = this;

        self.opts = opts;



    },

    getCompressImgData: function (){

        var res = '';
        
        res = $canvas[0].toDataURL('image/jpeg', 1);
        
        return res;
    },

    _drawImg: function ( obj ){
        var self = this;
        var url = webkitURL.createObjectURL( obj );
        var oImg = new Image();
        oImg.src = url;
        oImg.onload = function() {
 
            
            var width = oImg.width,
                height = oImg.height,
                clientScale = width / height;

            if( !(self.scale !== clientScale) ){

                alert('请上传指定尺寸图片');

            }else{

                //如果图片太大
                if( self.file.size > 77245 ){ 
                    //生成canvas
                    var $canvas = $( self.canvas );
                    var ctx = $canvas[0].getContext('2d');
                    $canvas.attr({width : width, height : height});
                    ctx.drawImage(oImg, 0, 0, width, height);
                    var base64 = $canvas[0].toDataURL('image/jpeg', 1);
                }

            }
 
 
        }
    },

    _bind: function (){

    }

    constructor: ImgCompress


};



var oImgCompress = new ImgCompress();

oImgCompress.init({
    width: 400,
    height: 300,
    bLockScale: false,
    maxSize: '120kb'
});
$(':file').on('change',function(){
        var file = this.files[0];
        var url = webkitURL.createObjectURL(file);
 
        /* 生成图片
        * ---------------------- */
        var oImg = new Image();
        oImg.onload = function() {
 
            //生成比例
            var width = oImg.width,
                    height = oImg.height,
                    scale = width / height;
            width = parseInt(800);
            height = parseInt(width / scale);
 
            //生成canvas
            var $canvas = $('#canvas1');
            var ctx = $canvas[0].getContext('2d');
            $canvas.attr({width : width, height : height});
            ctx.drawImage(oImg, 0, 0, width, height);
            var base64 = $canvas[0].toDataURL('image/jpeg', 1);

            var base64 = ImgCompress.getCompressImgData();

            console.log(base64);
            //发送到服务端
            /*$.post('upload.php',{formFile : base64.substr(22) },function(data){
                $('#php').html(data);
            });*/
 
        }
        oImg.src = url;
 
    });





</script>
</body>
</html>